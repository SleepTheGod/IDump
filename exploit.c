// godpipe_server_dumper.c - SleepTheGod internal configs slurp edition
// gcc -o dumpcfg godpipe_server_dumper.c -Wall -O2 -s
// Run as root â†’ ./dumpcfg â†’ watch the server spill its guts

#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <string.h>
#include <errno.h>

static void print_signature(void) {
    printf("\e[38;5;129m");
    printf("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n");
    printf("â•‘      Made By Taylor Christian Newsome      â•‘\n");
    printf("â•‘     aka ClumsyLulz aka SleepTheGod         â•‘\n");
    printf("â•‘         @Lulz Clumsy - C God               â•‘\n");
    printf("â•‘   Server configs dumper - Waifu edition ðŸ’• â•‘\n");
    printf("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n\e[0m");
}

static void slurp_file(const char *path) {
    struct stat st;
    if (stat(path, &st) == -1) {
        // silent skip if not exist
        return;
    }

    if (!S_ISREG(st.st_mode)) return;

    int fd = open(path, O_RDONLY);
    if (fd == -1) return;

    printf("â”Œâ”€ %s  (uid:%d gid:%d mode:0%o  size:%ld)\n", 
           path, st.st_uid, st.st_gid, st.st_mode & 07777, (long)st.st_size);

    char buf[8192];
    ssize_t n;
    while ((n = read(fd, buf, sizeof(buf))) > 0) {
        if (write(STDOUT_FILENO, buf, n) != n) break;
    }
    close(fd);

    printf("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n");
}

int main(void) {
    print_signature();

    if (geteuid() != 0) {
        printf("Run me as root senpai~  (current euid: %d)\n", geteuid());
        return 1;
    }

    printf("Dumping juicy internal server configs... hold tight king ðŸ˜ˆ\n\n");

    const char *targets[] = {
        "/etc/passwd",
        "/etc/shadow",
        "/etc/group",
        "/etc/sudoers",
        "/etc/sudoers.d/*",
        "/etc/apache2/apache2.conf",
        "/etc/apache2/sites-enabled/*",
        "/etc/nginx/nginx.conf",
        "/etc/nginx/conf.d/*",
        "/etc/nginx/sites-enabled/*",
        "/etc/httpd/conf/httpd.conf",
        "/etc/httpd/conf.d/*",
        "/etc/mysql/my.cnf",
        "/etc/mysql/conf.d/*",
        "/etc/mysql/mariadb.conf.d/*",
        "/etc/postgresql/*/main/postgresql.conf",
        "/etc/postgresql/*/main/pg_hba.conf",
        "/etc/redis/redis.conf",
        "/etc/mongod.conf",
        "/etc/ssh/sshd_config",
        "/etc/ssh/ssh_config",
        "/etc/docker/daemon.json",
        "/etc/hosts",
        "/etc/resolv.conf",
        "/etc/environment",
        "/var/www/html/wp-config.php",
        "/var/www/html/config.php",
        "/var/www/html/.env",
        NULL
    };

    for (int i = 0; targets[i]; i++) {
        slurp_file(targets[i]);
    }

    printf("Dump complete. Your server just confessed everything to SleepTheGod ðŸ’¦\n");
    printf("Alpharetta owns the night @portknock ðŸ”¥\n");

    return 0;
}
